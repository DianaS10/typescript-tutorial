(()=>{"use strict";class e{constructor(e,t,n,r){this.templeteElement=document.getElementById(e),this.hostElement=document.getElementById(t);const s=document.importNode(this.templeteElement.content,!0);this.element=s.firstElementChild,r&&(this.element.id=r),this.attach(n)}attach(e){this.hostElement.insertAdjacentElement(e?"afterbegin":"beforeend",this.element)}}function t(e){let t=!0;return e.required&&(t=t&&0!==e.value.toString().trim().length),null!=e.minLength&&"string"==typeof e.value&&(t=t&&e.value.length>=e.minLength),null!=e.maxLength&&"string"==typeof e.value&&(t=t&&e.value.length<=e.maxLength),null!=e.min&&"number"==typeof e.value&&(t=t&&e.value>=e.min),null!=e.max&&"number"==typeof e.value&&(t=t&&e.value<=e.max),t}function n(e,t,n){const r=n.value;return{configurable:!0,get(){return r.bind(this)}}}var r;!function(e){e[e.Active=0]="Active",e[e.Finished=1]="Finished"}(r||(r={}));class s{constructor(e,t,n,r,s){this.id=e,this.title=t,this.description=n,this.people=r,this.status=s}}class i extends class{constructor(){this.listeners=[]}addListener(e){this.listeners.push(e)}}{constructor(){super(),this.projects=[]}static getInstance(){return this.instance||(this.instance=new i),this.instance}addProject(e,t,n){const i=new s(Math.random().toString(),e,t,n,r.Active);this.projects.push(i),this.updateListeners()}moveProject(e,t){const n=this.projects.find((t=>t.id===e));n&&n.status!==t&&(n.status=t,this.updateListeners())}updateListeners(){for(const e of this.listeners)e(this.projects.slice())}}console.log("RUNNING...");const l=i.getInstance();class o extends e{constructor(){super("project-input","app",!0,"user-input"),this.titleInputElement=this.element.querySelector("#title"),this.descriptionInputElement=this.element.querySelector("#description"),this.peopleInputElement=this.element.querySelector("#people"),this.configure()}configure(){this.element.addEventListener("submit",this.submitHandler)}renderContent(){}gatherUserInput(){const e=this.titleInputElement.value,n=this.descriptionInputElement.value,r=this.peopleInputElement.value,s={value:n,required:!0,minLength:5},i={value:+r,required:!0,min:1,max:5};return t({value:e,required:!0})&&t(s)&&t(i)?[e,n,+r]:void alert("Invalid input, please try again!")}clearInputs(){this.titleInputElement.value="",this.descriptionInputElement.value="",this.peopleInputElement.value=""}submitHandler(e){e.preventDefault();const t=this.gatherUserInput();if(Array.isArray(t)){const[e,n,r]=t;console.log(e,n,r),l.addProject(e,n,r),this.clearInputs()}}}!function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);i>3&&l&&Object.defineProperty(t,n,l)}([n],o.prototype,"submitHandler",null);class a extends e{constructor(e,t){super("single-project",e,!1,t.id),this.project=t,this.configure(),this.renderContent()}get persons(){return 1===this.project.people?"1 person":`${this.project.people} persons`}dragStartHandler(e){e.dataTransfer.setData("text/plain",this.project.id),e.dataTransfer.effectAllowed="move"}dragEndHandler(e){console.log("DragEnd")}configure(){this.element.addEventListener("dragstart",this.dragStartHandler),this.element.addEventListener("dragend",this.dragEndHandler)}renderContent(){this.element.querySelector("h2").textContent=this.project.title,this.element.querySelector("h3").textContent=this.persons+" assigned",this.element.querySelector("p").textContent=this.project.description}}!function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);i>3&&l&&Object.defineProperty(t,n,l)}([n],a.prototype,"dragStartHandler",null);var c=function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);return i>3&&l&&Object.defineProperty(t,n,l),l};class d extends e{constructor(e){super("project-list","app",!1,`${e}-projects`),this.type=e,this.asignedProjects=[],this.configure(),this.renderContent()}dragOverHandler(e){e.dataTransfer&&"text/plain"===e.dataTransfer.types[0]&&(e.preventDefault(),this.element.querySelector("ul").classList.add("droppable"))}dropHandler(e){const t=e.dataTransfer.getData("text/plain");l.moveProject(t,"active"===this.type?r.Active:r.Finished)}dragLeaveHandler(e){this.element.querySelector("ul").classList.remove("droppable")}configure(){this.element.addEventListener("dragover",this.dragOverHandler),this.element.addEventListener("dragleave",this.dragLeaveHandler),this.element.addEventListener("drop",this.dropHandler),l.addListener((e=>{const t=e.filter((e=>"active"===this.type?e.status===r.Active:e.status===r.Finished));this.asignedProjects=t,this.renderProjects()}))}renderContent(){const e=`${this.type}-projects-list`;this.element.querySelector("ul").id=e,this.element.querySelector("h2").textContent=this.type.toUpperCase()+" PROJECTS"}renderProjects(){document.getElementById(`${this.type}-projects-list`).innerHTML="";for(const e of this.asignedProjects)new a(this.element.querySelector("ul").id,e)}}c([n],d.prototype,"dragOverHandler",null),c([n],d.prototype,"dropHandler",null),c([n],d.prototype,"dragLeaveHandler",null),new o,new d("active"),new d("finished")})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUFBUWlFLGlCQUFpQixXQUFZekUsS0FBS3NHLGlCQUMvQ3RHLEtBQUtRLFFBQVFpRSxpQkFBaUIsWUFBYXpFLEtBQUs4RyxrQkFDaEQ5RyxLQUFLUSxRQUFRaUUsaUJBQWlCLE9BQVF6RSxLQUFLMEcsYUFFM0N6QyxFQUFhdkIsYUFBYUksSUFDdEIsTUFBTWtFLEVBQW1CbEUsRUFBU21FLFFBQU9wRCxHQUNuQixXQUFkN0QsS0FBS29HLEtBQ0V2QyxFQUFJdEIsU0FBV0wsRUFBY29CLE9BRWpDTyxFQUFJdEIsU0FBV0wsRUFBYzJFLFdBRXhDN0csS0FBS3FHLGdCQUFrQlcsRUFDdkJoSCxLQUFLa0gsb0JBSWJ2QyxnQkFDSSxNQUFNd0MsRUFBUyxHQUFHbkgsS0FBS29HLHFCQUN2QnBHLEtBQUtRLFFBQVE2RCxjQUFjLE1BQU8zRCxHQUFLeUcsRUFDdkNuSCxLQUFLUSxRQUFRNkQsY0FBYyxNQUFPNkIsWUFBY2xHLEtBQUtvRyxLQUFLZ0IsY0FBZ0IsWUFHdEVGLGlCQUNXaEgsU0FBU0MsZUFBZSxHQUFHSCxLQUFLb0csc0JBQ3hDaUIsVUFBWSxHQUNuQixJQUFLLE1BQU1DLEtBQVd0SCxLQUFLcUcsZ0JBSXZCLElBQUlYLEVBQVkxRixLQUFLUSxRQUFRNkQsY0FBYyxNQUFPM0QsR0FBSTRHLElBbkQ5RCxHQURDNUYsRyxvQ0FVRCxHQURDQSxHLGdDQVFELEdBRENBLEcscUNDaElZLElBQUl5QyxFQUNDLElBQUlnQyxFQUFZLFVBQ2QsSUFBSUEsRUFBWSxhIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdHlwZXNjcmlwdC10dXRvcmlhbC8uL3NyYy9jb21wb25lbnRzL2Jhc2UtY29tcG9uZW50LnRzIiwid2VicGFjazovL3R5cGVzY3JpcHQtdHV0b3JpYWwvLi9zcmMvdXRpbC92YWxpZGF0aW9uLnRzIiwid2VicGFjazovL3R5cGVzY3JpcHQtdHV0b3JpYWwvLi9zcmMvZGVjb3JhdG9ycy9hdXRvYmluZC50cyIsIndlYnBhY2s6Ly90eXBlc2NyaXB0LXR1dG9yaWFsLy4vc3JjL21vZGVscy9wcm9qZWN0LnRzIiwid2VicGFjazovL3R5cGVzY3JpcHQtdHV0b3JpYWwvLi9zcmMvc3RhdGUvcHJvamVjdC1zdGF0ZS50cyIsIndlYnBhY2s6Ly90eXBlc2NyaXB0LXR1dG9yaWFsLy4vc3JjL2NvbXBvbmVudHMvcHJvamVjdC1pbnB1dC50cyIsIndlYnBhY2s6Ly90eXBlc2NyaXB0LXR1dG9yaWFsLy4vc3JjL2NvbXBvbmVudHMvcHJvamVjdC1pdGVtLnRzIiwid2VicGFjazovL3R5cGVzY3JpcHQtdHV0b3JpYWwvLi9zcmMvY29tcG9uZW50cy9wcm9qZWN0LWxpc3QudHMiLCJ3ZWJwYWNrOi8vdHlwZXNjcmlwdC10dXRvcmlhbC8uL3NyYy9hcHAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy9Db21wb25lbnQgQmFzZSBDbGFzc1xuLy8gbmFtZXNwYWNlIEFwcCB7XG4vLyAgICAgZXhwb3J0IGFic3RyYWN0IGNsYXNzIENvbXBvbmVudDxUIGV4dGVuZHMgSFRNTEVsZW1lbnQsIFUgZXh0ZW5kcyBIVE1MRWxlbWVudD4ge1xuLy8gICAgICAgICB0ZW1wbGV0ZUVsZW1lbnQ6IEhUTUxUZW1wbGF0ZUVsZW1lbnQ7XG4vLyAgICAgICAgIGhvc3RFbGVtZW50OiBUO1xuLy8gICAgICAgICBlbGVtZW50OiBVOyBcblxuLy8gICAgICAgICBjb25zdHJ1Y3Rvcihcbi8vICAgICAgICAgICAgIHRlbXBsYXRlSWQ6IHN0cmluZywgXG4vLyAgICAgICAgICAgICBob3N0RWxlbWVudElkOiBzdHJpbmcsIFxuLy8gICAgICAgICAgICAgaW5zZXJ0QXRTdGFydDogYm9vbGVhbixcbi8vICAgICAgICAgICAgIG5ld0VsZW1lbnRJZD86IHN0cmluZykge1xuLy8gICAgICAgICAgICAgdGhpcy50ZW1wbGV0ZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0ZW1wbGF0ZUlkKSEgYXMgSFRNTFRlbXBsYXRlRWxlbWVudDtcbi8vICAgICAgICAgICAgIHRoaXMuaG9zdEVsZW1lbnQgPSAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaG9zdEVsZW1lbnRJZCkhIGFzIFQ7XG5cbi8vICAgICAgICAgICAgIGNvbnN0IGltcG9ydGVkTm9kZSA9IGRvY3VtZW50LmltcG9ydE5vZGUodGhpcy50ZW1wbGV0ZUVsZW1lbnQuY29udGVudCwgdHJ1ZSk7XG4vLyAgICAgICAgICAgICB0aGlzLmVsZW1lbnQgPSBpbXBvcnRlZE5vZGUuZmlyc3RFbGVtZW50Q2hpbGQgYXMgVTtcbi8vICAgICAgICAgICAgIGlmIChuZXdFbGVtZW50SWQpIHtcbi8vICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuaWQgPSBuZXdFbGVtZW50SWQ7XG4vLyAgICAgICAgICAgICB9XG5cbi8vICAgICAgICAgICAgIHRoaXMuYXR0YWNoKGluc2VydEF0U3RhcnQpO1xuLy8gICAgICAgICB9XG5cbi8vICAgICAgICAgcHJpdmF0ZSBhdHRhY2goaW5zZXJ0QXRCZWdnaW5pbmc6IGJvb2xlYW4pIHtcbi8vICAgICAgICAgICAgIHRoaXMuaG9zdEVsZW1lbnQuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KFxuLy8gICAgICAgICAgICAgICAgIGluc2VydEF0QmVnZ2luaW5nID8gJ2FmdGVyYmVnaW4nIDogJ2JlZm9yZWVuZCcsIFxuLy8gICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudCk7XG4vLyAgICAgICAgIH1cblxuLy8gICAgICAgICBhYnN0cmFjdCBjb25maWd1cmUoKTogdm9pZDtcbi8vICAgICAgICAgYWJzdHJhY3QgcmVuZGVyQ29udGVudCgpOiB2b2lkO1xuLy8gICAgIH1cbi8vIH1cblxuZXhwb3J0IGNvbnN0IHNvbWV0aGluZyA9ICcuLi4nO1xuXG4vL0NvbXBvbmVudCBCYXNlIENsYXNzXG4vLyBvbmx5IG9uZSBkZWZhdWx0IGV4cG9ydCBwZXIgZmlsZVxuZXhwb3J0IGRlZmF1bHQgYWJzdHJhY3QgY2xhc3MgQ29tcG9uZW50PFQgZXh0ZW5kcyBIVE1MRWxlbWVudCwgVSBleHRlbmRzIEhUTUxFbGVtZW50PiB7XG4gICAgdGVtcGxldGVFbGVtZW50OiBIVE1MVGVtcGxhdGVFbGVtZW50OyAvLyB0ZW1wbGF0ZSB3ZSB3YW50IHRvIHJlbmRlclxuICAgIGhvc3RFbGVtZW50OiBUOyAvLyB3aGVyZSB3ZSB3YW50IHRvIHJlbmRlclxuICAgIGVsZW1lbnQ6IFU7IC8vIHRoZSBjb25jcmV0ZSBlbGVtZW50IHRvIGJlIHJlbmRlcmVkXG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgdGVtcGxhdGVJZDogc3RyaW5nLCBcbiAgICAgICAgaG9zdEVsZW1lbnRJZDogc3RyaW5nLCBcbiAgICAgICAgaW5zZXJ0QXRTdGFydDogYm9vbGVhbixcbiAgICAgICAgbmV3RWxlbWVudElkPzogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMudGVtcGxldGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGVtcGxhdGVJZCkhIGFzIEhUTUxUZW1wbGF0ZUVsZW1lbnQ7XG4gICAgICAgIHRoaXMuaG9zdEVsZW1lbnQgPSAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaG9zdEVsZW1lbnRJZCkhIGFzIFQ7XG5cbiAgICAgICAgY29uc3QgaW1wb3J0ZWROb2RlID0gZG9jdW1lbnQuaW1wb3J0Tm9kZSh0aGlzLnRlbXBsZXRlRWxlbWVudC5jb250ZW50LCB0cnVlKTtcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gaW1wb3J0ZWROb2RlLmZpcnN0RWxlbWVudENoaWxkIGFzIFU7XG4gICAgICAgIGlmIChuZXdFbGVtZW50SWQpIHtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5pZCA9IG5ld0VsZW1lbnRJZDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYXR0YWNoKGluc2VydEF0U3RhcnQpO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXR0YWNoKGluc2VydEF0QmVnZ2luaW5nOiBib29sZWFuKSB7XG4gICAgICAgIHRoaXMuaG9zdEVsZW1lbnQuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KFxuICAgICAgICAgICAgaW5zZXJ0QXRCZWdnaW5pbmcgPyAnYWZ0ZXJiZWdpbicgOiAnYmVmb3JlZW5kJywgXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQpO1xuICAgIH1cblxuICAgIGFic3RyYWN0IGNvbmZpZ3VyZSgpOiB2b2lkO1xuICAgIGFic3RyYWN0IHJlbmRlckNvbnRlbnQoKTogdm9pZDtcbn0iLCIvLyBuYW1lc3BhY2UgQXBwIHtcbi8vICAgICAvLyBWYWxpZGF0aW9uXG4vLyAgICAgZXhwb3J0IGludGVyZmFjZSBWYWxpZGF0YWJsZSB7XG4vLyAgICAgICAgIHZhbHVlOiBzdHJpbmcgfCBudW1iZXI7XG4vLyAgICAgICAgIHJlcXVpcmVkPzogYm9vbGVhbjtcbi8vICAgICAgICAgbWluTGVuZ3RoPzogbnVtYmVyO1xuLy8gICAgICAgICBtYXhMZW5ndGg/OiBudW1iZXI7XG4vLyAgICAgICAgIG1pbj86IG51bWJlcjtcbi8vICAgICAgICAgbWF4PzogbnVtYmVyO1xuLy8gICAgIH1cblxuLy8gICAgIGV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZSh2YWxpZGF0YWJsZUlucHV0OiBWYWxpZGF0YWJsZSkge1xuLy8gICAgICAgICBsZXQgaXNWYWxpZCA9IHRydWU7XG5cbi8vICAgICAgICAgaWYgKHZhbGlkYXRhYmxlSW5wdXQucmVxdWlyZWQpIHtcbi8vICAgICAgICAgICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUudG9TdHJpbmcoKS50cmltKCkubGVuZ3RoICE9PSAwO1xuLy8gICAgICAgICB9XG4vLyAgICAgICAgIGlmICh2YWxpZGF0YWJsZUlucHV0Lm1pbkxlbmd0aCAhPSBudWxsICYmIFxuLy8gICAgICAgICAgICAgdHlwZW9mIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPT09ICdzdHJpbmcnKSB7XG4vLyAgICAgICAgICAgICBpc1ZhbGlkID0gaXNWYWxpZCAmJiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlLmxlbmd0aCA+PSB2YWxpZGF0YWJsZUlucHV0Lm1pbkxlbmd0aDtcbi8vICAgICAgICAgfVxuLy8gICAgICAgICBpZiAodmFsaWRhdGFibGVJbnB1dC5tYXhMZW5ndGggIT0gbnVsbCAmJiBcbi8vICAgICAgICAgICAgIHR5cGVvZiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlID09PSAnc3RyaW5nJykge1xuLy8gICAgICAgICAgICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZS5sZW5ndGggPD0gdmFsaWRhdGFibGVJbnB1dC5tYXhMZW5ndGg7XG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgaWYgKHZhbGlkYXRhYmxlSW5wdXQubWluICE9IG51bGwgJiYgXG4vLyAgICAgICAgICAgICB0eXBlb2YgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA9PT0gJ251bWJlcicpIHtcbi8vICAgICAgICAgICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPj0gdmFsaWRhdGFibGVJbnB1dC5taW47XG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgaWYgKHZhbGlkYXRhYmxlSW5wdXQubWF4ICE9IG51bGwgJiYgXG4vLyAgICAgICAgICAgICB0eXBlb2YgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA9PT0gJ251bWJlcicpIHtcbi8vICAgICAgICAgICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPD0gdmFsaWRhdGFibGVJbnB1dC5tYXg7XG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgcmV0dXJuIGlzVmFsaWQ7XG4vLyAgICAgfVxuLy8gfVxuXG4vLyBWYWxpZGF0aW9uXG5leHBvcnQgaW50ZXJmYWNlIFZhbGlkYXRhYmxlIHtcbiAgICB2YWx1ZTogc3RyaW5nIHwgbnVtYmVyO1xuICAgIHJlcXVpcmVkPzogYm9vbGVhbjtcbiAgICBtaW5MZW5ndGg/OiBudW1iZXI7XG4gICAgbWF4TGVuZ3RoPzogbnVtYmVyO1xuICAgIG1pbj86IG51bWJlcjtcbiAgICBtYXg/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZSh2YWxpZGF0YWJsZUlucHV0OiBWYWxpZGF0YWJsZSkge1xuICAgIGxldCBpc1ZhbGlkID0gdHJ1ZTtcblxuICAgIGlmICh2YWxpZGF0YWJsZUlucHV0LnJlcXVpcmVkKSB7XG4gICAgICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUudG9TdHJpbmcoKS50cmltKCkubGVuZ3RoICE9PSAwO1xuICAgIH1cbiAgICBpZiAodmFsaWRhdGFibGVJbnB1dC5taW5MZW5ndGggIT0gbnVsbCAmJiBcbiAgICAgICAgdHlwZW9mIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUubGVuZ3RoID49IHZhbGlkYXRhYmxlSW5wdXQubWluTGVuZ3RoO1xuICAgIH1cbiAgICBpZiAodmFsaWRhdGFibGVJbnB1dC5tYXhMZW5ndGggIT0gbnVsbCAmJiBcbiAgICAgICAgdHlwZW9mIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUubGVuZ3RoIDw9IHZhbGlkYXRhYmxlSW5wdXQubWF4TGVuZ3RoO1xuICAgIH1cbiAgICBpZiAodmFsaWRhdGFibGVJbnB1dC5taW4gIT0gbnVsbCAmJiBcbiAgICAgICAgdHlwZW9mIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPT09ICdudW1iZXInKSB7XG4gICAgICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPj0gdmFsaWRhdGFibGVJbnB1dC5taW47XG4gICAgfVxuICAgIGlmICh2YWxpZGF0YWJsZUlucHV0Lm1heCAhPSBudWxsICYmIFxuICAgICAgICB0eXBlb2YgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA8PSB2YWxpZGF0YWJsZUlucHV0Lm1heDtcbiAgICB9XG4gICAgcmV0dXJuIGlzVmFsaWQ7XG59IiwiLy8gbmFtZXNwYWNlIEFwcCB7XG4vLyAgICAgLy8gYXV0b2JpbmQgZGVjb3JhdG9yXG4vLyAgICAgZXhwb3J0IGZ1bmN0aW9uICBhdXRvYmluZChcbi8vICAgICAgICAgXzogYW55LCAvLyB0YXJnZXQgYXJndW1lbnQgaXMgbm90IHVzZWRcbi8vICAgICAgICAgXzI6IHN0cmluZywgLy8gbWV0aG9kTmFtZSBhcmd1bWVudCBpcyBub3QgdXNlZFxuLy8gICAgICAgICBkZXNjcmlwdG9yOiBQcm9wZXJ0eURlc2NyaXB0b3Jcbi8vICAgICAgICAgKSB7XG4vLyAgICAgICAgIGNvbnN0IG9yaWdpbmFsTWV0aG9kID0gZGVzY3JpcHRvci52YWx1ZTtcbi8vICAgICAgICAgY29uc3QgYWRqRGVzY3JpcHRvcjogUHJvcGVydHlEZXNjcmlwdG9yID0ge1xuLy8gICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuLy8gICAgICAgICAgICAgZ2V0KCkge1xuLy8gICAgICAgICAgICAgICAgIGNvbnN0IGJvdW5kRm4gPSBvcmlnaW5hbE1ldGhvZC5iaW5kKHRoaXMpO1xuLy8gICAgICAgICAgICAgICAgIHJldHVybiBib3VuZEZuO1xuLy8gICAgICAgICAgICAgfVxuLy8gICAgICAgICB9O1xuLy8gICAgICAgICByZXR1cm4gYWRqRGVzY3JpcHRvcjtcbi8vICAgICB9XG4vLyB9XG5cbi8vIGF1dG9iaW5kIGRlY29yYXRvclxuZXhwb3J0IGZ1bmN0aW9uICBhdXRvYmluZChcbiAgICBfOiBhbnksIC8vIHRhcmdldCBhcmd1bWVudCBpcyBub3QgdXNlZFxuICAgIF8yOiBzdHJpbmcsIC8vIG1ldGhvZE5hbWUgYXJndW1lbnQgaXMgbm90IHVzZWRcbiAgICBkZXNjcmlwdG9yOiBQcm9wZXJ0eURlc2NyaXB0b3JcbiAgICApIHtcbiAgICBjb25zdCBvcmlnaW5hbE1ldGhvZCA9IGRlc2NyaXB0b3IudmFsdWU7XG4gICAgY29uc3QgYWRqRGVzY3JpcHRvcjogUHJvcGVydHlEZXNjcmlwdG9yID0ge1xuICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgIGdldCgpIHtcbiAgICAgICAgICAgIGNvbnN0IGJvdW5kRm4gPSBvcmlnaW5hbE1ldGhvZC5iaW5kKHRoaXMpO1xuICAgICAgICAgICAgcmV0dXJuIGJvdW5kRm47XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiBhZGpEZXNjcmlwdG9yO1xufSIsIi8vIG5hbWVzcGFjZSBBcHAge1xuLy8gICAgIGV4cG9ydCBlbnVtIFByb2plY3RTdGF0dXMge1xuLy8gICAgICAgICBBY3RpdmUsXG4vLyAgICAgICAgIEZpbmlzaGVkXG4vLyAgICAgfVxuICAgIFxuLy8gICAgIGV4cG9ydCBjbGFzcyBQcm9qZWN0IHtcbi8vICAgICAgICAgY29uc3RydWN0b3IocHVibGljIGlkOiBzdHJpbmcsIFxuLy8gICAgICAgICAgICAgcHVibGljIHRpdGxlOiBzdHJpbmcsIFxuLy8gICAgICAgICAgICAgcHVibGljIGRlc2NyaXB0aW9uOiBzdHJpbmcsXG4vLyAgICAgICAgICAgICBwdWJsaWMgcGVvcGxlOiBudW1iZXIsXG4vLyAgICAgICAgICAgICBwdWJsaWMgc3RhdHVzOiBQcm9qZWN0U3RhdHVzXG4vLyAgICAgICAgICAgICApIHt9XG4vLyAgICAgfVxuLy8gfVxuXG5leHBvcnQgZW51bSBQcm9qZWN0U3RhdHVzIHtcbiAgICBBY3RpdmUsXG4gICAgRmluaXNoZWRcbn1cblxuZXhwb3J0IGNsYXNzIFByb2plY3Qge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwdWJsaWMgaWQ6IHN0cmluZywgXG4gICAgICAgIHB1YmxpYyB0aXRsZTogc3RyaW5nLCBcbiAgICAgICAgcHVibGljIGRlc2NyaXB0aW9uOiBzdHJpbmcsXG4gICAgICAgIHB1YmxpYyBwZW9wbGU6IG51bWJlcixcbiAgICAgICAgcHVibGljIHN0YXR1czogUHJvamVjdFN0YXR1c1xuICAgICAgICApIHt9XG59XG4iLCIvLyBuYW1lc3BhY2UgQXBwIHtcbi8vICAgICAvLyBQcm9qZWN0IFN0YXRlIE1hbmFnZW1lbnRcbi8vICAgICB0eXBlIExpc3RlbmVyPFQ+ID0gKGl0ZW1zOiBUW10pID0+IHZvaWQ7XG5cbi8vICAgICBjbGFzcyBTdGF0ZTxUPiB7XG4vLyAgICAgICAgIHByb3RlY3RlZCBsaXN0ZW5lcnM6IExpc3RlbmVyPFQ+W10gPSBbXTtcblxuLy8gICAgICAgICBhZGRMaXN0ZW5lcihsaXN0ZW5lckZuOiBMaXN0ZW5lcjxUPikge1xuLy8gICAgICAgICAgICAgdGhpcy5saXN0ZW5lcnMucHVzaChsaXN0ZW5lckZuKTtcbi8vICAgICAgICAgfVxuLy8gICAgIH1cblxuLy8gICAgIGV4cG9ydCBjbGFzcyBQcm9qZWN0U3RhdGUgZXh0ZW5kcyBTdGF0ZTxQcm9qZWN0PiB7XG4gICAgICAgIFxuLy8gICAgICAgICBwcml2YXRlIHByb2plY3RzOiBQcm9qZWN0W10gPSBbXTtcbi8vICAgICAgICAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IFByb2plY3RTdGF0ZTtcblxuLy8gICAgICAgICBwcml2YXRlIGNvbnN0cnVjdG9yKCkge1xuLy8gICAgICAgICAgICAgc3VwZXIoKTtcbi8vICAgICAgICAgfVxuXG4vLyAgICAgICAgIHN0YXRpYyBnZXRJbnN0YW5jZSgpIHtcbi8vICAgICAgICAgICAgIGlmICh0aGlzLmluc3RhbmNlKSB7XG4vLyAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2U7XG4vLyAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgICB0aGlzLmluc3RhbmNlID0gbmV3IFByb2plY3RTdGF0ZSgpO1xuLy8gICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2U7XG4vLyAgICAgICAgIH0gICAgXG5cbi8vICAgICAgICAgYWRkUHJvamVjdCh0aXRsZTogc3RyaW5nLCBkZXNjcmlwdGlvbjogc3RyaW5nLCBudW1PZlBlb3BsZTogbnVtYmVyKSB7XG4vLyAgICAgICAgICAgICBjb25zdCBuZXdQcm9qZWN0ID0gbmV3IFByb2plY3QoXG4vLyAgICAgICAgICAgICAgICAgTWF0aC5yYW5kb20oKS50b1N0cmluZygpLCBcbi8vICAgICAgICAgICAgICAgICB0aXRsZSwgZGVzY3JpcHRpb24sIFxuLy8gICAgICAgICAgICAgICAgIG51bU9mUGVvcGxlLCBcbi8vICAgICAgICAgICAgICAgICBQcm9qZWN0U3RhdHVzLkFjdGl2ZSlcbi8vICAgICAgICAgICAgIHRoaXMucHJvamVjdHMucHVzaChuZXdQcm9qZWN0KTtcbi8vICAgICAgICAgICAgIHRoaXMudXBkYXRlTGlzdGVuZXJzKCk7XG4vLyAgICAgICAgIH1cblxuLy8gICAgICAgICAvLyBzd2l0Y2ggcHJvamVjdCBzdGF0dXNcbi8vICAgICAgICAgbW92ZVByb2plY3QocHJvamVjdElkOiBzdHJpbmcsIG5ld1N0YXR1czogUHJvamVjdFN0YXR1cykge1xuLy8gICAgICAgICAgICAgY29uc3QgcHJvamVjdCA9IHRoaXMucHJvamVjdHMuZmluZChwcmogPT4gcHJqLmlkID09PSBwcm9qZWN0SWQpO1xuLy8gICAgICAgICAgICAgaWYgKHByb2plY3QgJiYgcHJvamVjdC5zdGF0dXMgIT09IG5ld1N0YXR1cykge1xuLy8gICAgICAgICAgICAgICAgIHByb2plY3Quc3RhdHVzID0gbmV3U3RhdHVzO1xuLy8gICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlTGlzdGVuZXJzKCk7XG4vLyAgICAgICAgICAgICB9XG4vLyAgICAgICAgIH1cblxuLy8gICAgICAgICBwcml2YXRlIHVwZGF0ZUxpc3RlbmVycygpIHtcbi8vICAgICAgICAgICAgIGZvciAoY29uc3QgbGlzdGVuZXJGbiBvZiB0aGlzLmxpc3RlbmVycykge1xuLy8gICAgICAgICAgICAgICAgIGxpc3RlbmVyRm4odGhpcy5wcm9qZWN0cy5zbGljZSgpKTtcbi8vICAgICAgICAgICAgIH1cbi8vICAgICAgICAgfVxuLy8gICAgIH1cblxuLy8gICAgIGV4cG9ydCBjb25zdCBwcm9qZWN0U3RhdGUgPSBQcm9qZWN0U3RhdGUuZ2V0SW5zdGFuY2UoKTtcbi8vIH1cblxuaW1wb3J0IHsgUHJvamVjdCwgUHJvamVjdFN0YXR1cyB9IGZyb20gJy4uL21vZGVscy9wcm9qZWN0JztcblxuLy8gUHJvamVjdCBTdGF0ZSBNYW5hZ2VtZW50XG50eXBlIExpc3RlbmVyPFQ+ID0gKGl0ZW1zOiBUW10pID0+IHZvaWQ7XG5cbmNsYXNzIFN0YXRlPFQ+IHtcbiAgICBwcm90ZWN0ZWQgbGlzdGVuZXJzOiBMaXN0ZW5lcjxUPltdID0gW107XG5cbiAgICBhZGRMaXN0ZW5lcihsaXN0ZW5lckZuOiBMaXN0ZW5lcjxUPikge1xuICAgICAgICB0aGlzLmxpc3RlbmVycy5wdXNoKGxpc3RlbmVyRm4pO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIFByb2plY3RTdGF0ZSBleHRlbmRzIFN0YXRlPFByb2plY3Q+IHtcbiAgICBcbiAgICBwcml2YXRlIHByb2plY3RzOiBQcm9qZWN0W10gPSBbXTtcbiAgICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogUHJvamVjdFN0YXRlO1xuXG4gICAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0SW5zdGFuY2UoKSB7XG4gICAgICAgIGlmICh0aGlzLmluc3RhbmNlKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pbnN0YW5jZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmluc3RhbmNlID0gbmV3IFByb2plY3RTdGF0ZSgpO1xuICAgICAgICByZXR1cm4gdGhpcy5pbnN0YW5jZTtcbiAgICB9ICAgIFxuXG4gICAgYWRkUHJvamVjdCh0aXRsZTogc3RyaW5nLCBkZXNjcmlwdGlvbjogc3RyaW5nLCBudW1PZlBlb3BsZTogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IG5ld1Byb2plY3QgPSBuZXcgUHJvamVjdChcbiAgICAgICAgICAgIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoKSwgXG4gICAgICAgICAgICB0aXRsZSwgZGVzY3JpcHRpb24sIFxuICAgICAgICAgICAgbnVtT2ZQZW9wbGUsIFxuICAgICAgICAgICAgUHJvamVjdFN0YXR1cy5BY3RpdmUpXG4gICAgICAgIHRoaXMucHJvamVjdHMucHVzaChuZXdQcm9qZWN0KTtcbiAgICAgICAgdGhpcy51cGRhdGVMaXN0ZW5lcnMoKTtcbiAgICB9XG5cbiAgICAvLyBzd2l0Y2ggcHJvamVjdCBzdGF0dXNcbiAgICBtb3ZlUHJvamVjdChwcm9qZWN0SWQ6IHN0cmluZywgbmV3U3RhdHVzOiBQcm9qZWN0U3RhdHVzKSB7XG4gICAgICAgIGNvbnN0IHByb2plY3QgPSB0aGlzLnByb2plY3RzLmZpbmQocHJqID0+IHByai5pZCA9PT0gcHJvamVjdElkKTtcbiAgICAgICAgaWYgKHByb2plY3QgJiYgcHJvamVjdC5zdGF0dXMgIT09IG5ld1N0YXR1cykge1xuICAgICAgICAgICAgcHJvamVjdC5zdGF0dXMgPSBuZXdTdGF0dXM7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUxpc3RlbmVycygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB1cGRhdGVMaXN0ZW5lcnMoKSB7XG4gICAgICAgIGZvciAoY29uc3QgbGlzdGVuZXJGbiBvZiB0aGlzLmxpc3RlbmVycykge1xuICAgICAgICAgICAgbGlzdGVuZXJGbih0aGlzLnByb2plY3RzLnNsaWNlKCkpO1xuICAgICAgICB9XG4gICAgfVxufVxuY29uc29sZS5sb2coJ1JVTk5JTkcuLi4nKTsgLy8gb25seSBydW5zIG9uY2VcblxuZXhwb3J0IGNvbnN0IHByb2plY3RTdGF0ZSA9IFByb2plY3RTdGF0ZS5nZXRJbnN0YW5jZSgpOyIsIi8vIC8vLyA8cmVmZXJlbmNlIHBhdGg9XCJiYXNlLWNvbXBvbmVudC50c1wiIC8+XG4vLyAvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vdXRpbC92YWxpZGF0aW9uLnRzXCIgLz5cbi8vIC8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi9kZWNvcmF0b3JzL2F1dG9iaW5kLnRzXCIgLz5cbi8vIC8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi9zdGF0ZS9wcm9qZWN0LXN0YXRlLnRzXCIgLz5cblxuLy8gbmFtZXNwYWNlIEFwcCB7XG4vLyAgICAgLy8gUHJvamVjdElucHV0IENsYXNzXG4vLyAgICAgZXhwb3J0IGNsYXNzIFByb2plY3RJbnB1dCBleHRlbmRzIENvbXBvbmVudDxIVE1MRGl2RWxlbWVudCwgSFRNTEZvcm1FbGVtZW50PiB7XG4vLyAgICAgICAgIC8vIHRlbXBsZXRlRWxlbWVudDogSFRNTFRlbXBsYXRlRWxlbWVudDtcbi8vICAgICAgICAgLy8gaG9zdEVsZW1lbnQ6IEhUTUxEaXZFbGVtZW50O1xuLy8gICAgICAgICAvLyBlbGVtZW50OiBIVE1MRm9ybUVsZW1lbnQ7XG4vLyAgICAgICAgIHRpdGxlSW5wdXRFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50O1xuLy8gICAgICAgICBkZXNjcmlwdGlvbklucHV0RWxlbWVudDogSFRNTElucHV0RWxlbWVudDtcbi8vICAgICAgICAgcGVvcGxlSW5wdXRFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50O1xuXG4vLyAgICAgICAgIGNvbnN0cnVjdG9yKCkge1xuLy8gICAgICAgICAgICAgc3VwZXIoJ3Byb2plY3QtaW5wdXQnLCAnYXBwJywgdHJ1ZSwgJ3VzZXItaW5wdXQnKTtcbi8vICAgICAgICAgICAgIC8vIHRoaXMudGVtcGxldGVFbGVtZW50ID0gPEhUTUxUZW1wbGF0ZUVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2plY3QtaW5wdXQnKSE7XG4vLyAgICAgICAgICAgICAvLyB0aGlzLnRlbXBsZXRlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9qZWN0LWlucHV0JykhIGFzIEhUTUxUZW1wbGF0ZUVsZW1lbnQ7XG4vLyAgICAgICAgICAgICAvLyB0aGlzLmhvc3RFbGVtZW50ID0gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcHAnKSEgYXMgSFRNTERpdkVsZW1lbnQ7XG5cbi8vICAgICAgICAgICAgIC8vIGNvbnN0IGltcG9ydGVkTm9kZSA9IGRvY3VtZW50LmltcG9ydE5vZGUodGhpcy50ZW1wbGV0ZUVsZW1lbnQuY29udGVudCwgdHJ1ZSk7XG4vLyAgICAgICAgICAgICAvLyB0aGlzLmVsZW1lbnQgPSBpbXBvcnRlZE5vZGUuZmlyc3RFbGVtZW50Q2hpbGQgYXMgSFRNTEZvcm1FbGVtZW50O1xuLy8gICAgICAgICAgICAgLy8gdGhpcy5lbGVtZW50LmlkID0gJ3VzZXItaW5wdXQnO1xuXG4gICAgICAgICAgICBcbi8vICAgICAgICAgICAgIHRoaXMudGl0bGVJbnB1dEVsZW1lbnQgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignI3RpdGxlJykgYXMgSFRNTElucHV0RWxlbWVudDtcbi8vICAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignI2Rlc2NyaXB0aW9uJykgYXMgSFRNTElucHV0RWxlbWVudDtcbi8vICAgICAgICAgICAgIHRoaXMucGVvcGxlSW5wdXRFbGVtZW50ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwZW9wbGUnKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgICAgICAgICAgXG4vLyAgICAgICAgICAgICB0aGlzLmNvbmZpZ3VyZSgpO1xuLy8gICAgICAgICAgICAgLy8gdGhpcy5hdHRhY2goKTtcbi8vICAgICAgICAgfVxuXG4vLyAgICAgICAgIGNvbmZpZ3VyZSgpIHtcbi8vICAgICAgICAgICAgIC8vIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCB0aGlzLnN1Ym1pdEhhbmRsZXIuYmluZCh0aGlzKSk7XG4vLyAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgdGhpcy5zdWJtaXRIYW5kbGVyKTtcbi8vICAgICAgICAgfVxuXG4vLyAgICAgICAgIHJlbmRlckNvbnRlbnQoKSB7XG5cbi8vICAgICAgICAgfVxuXG4vLyAgICAgICAgIHByaXZhdGUgZ2F0aGVyVXNlcklucHV0KCk6IFtzdHJpbmcsIHN0cmluZywgbnVtYmVyXSB8IHZvaWQge1xuLy8gICAgICAgICAgICAgY29uc3QgZW50ZXJlZFRpdGxlID0gdGhpcy50aXRsZUlucHV0RWxlbWVudC52YWx1ZTtcbi8vICAgICAgICAgICAgIGNvbnN0IGVudGVyZWREZXNjcmlwdGlvbiA9IHRoaXMuZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQudmFsdWU7XG4vLyAgICAgICAgICAgICBjb25zdCBlbnRlcmVkUGVvcGxlID0gdGhpcy5wZW9wbGVJbnB1dEVsZW1lbnQudmFsdWU7XG5cbi8vICAgICAgICAgICAgIGNvbnN0IHRpdGxlVmFsaWRhdGFibGU6IFZhbGlkYXRhYmxlID0ge1xuLy8gICAgICAgICAgICAgICAgIHZhbHVlOiBlbnRlcmVkVGl0bGUsXG4vLyAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWVcbi8vICAgICAgICAgICAgIH07XG4vLyAgICAgICAgICAgICBjb25zdCBkZXNjcmlwdGlvblZhbGlkYXRhYmxlOiBWYWxpZGF0YWJsZSA9IHtcbi8vICAgICAgICAgICAgICAgICB2YWx1ZTogZW50ZXJlZERlc2NyaXB0aW9uLFxuLy8gICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuLy8gICAgICAgICAgICAgICAgIG1pbkxlbmd0aDogNVxuLy8gICAgICAgICAgICAgfTtcbi8vICAgICAgICAgICAgIGNvbnN0IHBlb3BsZVZhbGlkYXRhYmxlOiBWYWxpZGF0YWJsZSA9IHtcbi8vICAgICAgICAgICAgICAgICB2YWx1ZTogK2VudGVyZWRQZW9wbGUsXG4vLyAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4vLyAgICAgICAgICAgICAgICAgbWluOiAxLFxuLy8gICAgICAgICAgICAgICAgIG1heDogNVxuLy8gICAgICAgICAgICAgfTtcblxuLy8gICAgICAgICAgICAgaWYgKFxuLy8gICAgICAgICAgICAgICAgIC8vIGVudGVyZWRUaXRsZS50cmltKCkubGVuZ3RoID09PSAwIHx8IFxuLy8gICAgICAgICAgICAgICAgIC8vIGVudGVyZWREZXNjcmlwdGlvbi50cmltKCkubGVuZ3RoID09PSAwIHx8IFxuLy8gICAgICAgICAgICAgICAgIC8vIGVudGVyZWRQZW9wbGUudHJpbSgpLmxlbmd0aCA9PT0gMFxuXG4vLyAgICAgICAgICAgICAgICAgIXZhbGlkYXRlKHRpdGxlVmFsaWRhdGFibGUpIHx8XG4vLyAgICAgICAgICAgICAgICAgIXZhbGlkYXRlKGRlc2NyaXB0aW9uVmFsaWRhdGFibGUpIHx8XG4vLyAgICAgICAgICAgICAgICAgIXZhbGlkYXRlKHBlb3BsZVZhbGlkYXRhYmxlKSBcbi8vICAgICAgICAgICAgICAgICApIHtcbi8vICAgICAgICAgICAgICAgICAgICAgYWxlcnQoJ0ludmFsaWQgaW1wdXQsIHBsZWFzZSB0cnkgYWdhaW4hJyk7XG4vLyAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbi8vICAgICAgICAgICAgIH0gZWxzZSB7XG4vLyAgICAgICAgICAgICAgICAgcmV0dXJuIFtlbnRlcmVkVGl0bGUsIGVudGVyZWREZXNjcmlwdGlvbiwgK2VudGVyZWRQZW9wbGVdO1xuLy8gICAgICAgICAgICAgfVxuLy8gICAgICAgICB9XG5cbi8vICAgICAgICAgcHJpdmF0ZSBjbGVhcklucHV0cygpIHtcbi8vICAgICAgICAgICAgIHRoaXMudGl0bGVJbnB1dEVsZW1lbnQudmFsdWUgPSAnJztcbi8vICAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQudmFsdWUgPSAnJztcbi8vICAgICAgICAgICAgIHRoaXMucGVvcGxlSW5wdXRFbGVtZW50LnZhbHVlID0gJyc7XG4vLyAgICAgICAgIH1cblxuLy8gICAgICAgICBAYXV0b2JpbmRcbi8vICAgICAgICAgcHJpdmF0ZSBzdWJtaXRIYW5kbGVyKGV2ZW50OiBFdmVudCkge1xuLy8gICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbi8vICAgICAgICAgICAgIC8vY29uc29sZS5sb2codGhpcy50aXRsZUlucHV0RWxlbWVudC52YWx1ZSk7XG4vLyAgICAgICAgICAgICBjb25zdCB1c2VySW5wdXQgPSB0aGlzLmdhdGhlclVzZXJJbnB1dCgpO1xuLy8gICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodXNlcklucHV0KSkge1xuLy8gICAgICAgICAgICAgICAgIGNvbnN0IFt0aXRsZSwgZGVzYywgcGVvcGxlXSA9IHVzZXJJbnB1dDtcbi8vICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0aXRsZSwgZGVzYywgcGVvcGxlKTtcbi8vICAgICAgICAgICAgICAgICBwcm9qZWN0U3RhdGUuYWRkUHJvamVjdCh0aXRsZSwgZGVzYywgcGVvcGxlKTtcbi8vICAgICAgICAgICAgICAgICB0aGlzLmNsZWFySW5wdXRzKCk7XG4vLyAgICAgICAgICAgICB9XG4vLyAgICAgICAgIH1cblxuLy8gICAgICAgICAvLyBwcml2YXRlIGF0dGFjaCgpIHtcbi8vICAgICAgICAgLy8gICAgIHRoaXMuaG9zdEVsZW1lbnQuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmJlZ2luJywgdGhpcy5lbGVtZW50KTtcbi8vICAgICAgICAgLy8gfVxuLy8gICAgIH1cbi8vIH1cblxuXG4vLyBpbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tICcuL2Jhc2UtY29tcG9uZW50LmpzJztcbmltcG9ydCBDb21wb25lbnQgZnJvbSAnLi9iYXNlLWNvbXBvbmVudCc7IC8vIGZvciBkZWZhdWx0IGV4cG9ydFxuLy8gaW1wb3J0IHsgVmFsaWRhdGFibGUsIHZhbGlkYXRlIH0gZnJvbSAnLi4vdXRpbC92YWxpZGF0aW9uLmpzJztcbmltcG9ydCAqIGFzIFZhbGlkYXRpb24gZnJvbSAnLi4vdXRpbC92YWxpZGF0aW9uJztcbi8vIGltcG9ydCB7IGF1dG9iaW5kIH0gZnJvbSAnLi4vZGVjb3JhdG9ycy9hdXRvYmluZC5qcyc7XG4vLyBBbGlhc2VzIHRvIGF2b2lkIG5hbWUgY2xhc2hlc1xuaW1wb3J0IHsgYXV0b2JpbmQgYXMgQXV0b2JpbmQgfSBmcm9tICcuLi9kZWNvcmF0b3JzL2F1dG9iaW5kJztcbmltcG9ydCB7IHByb2plY3RTdGF0ZSB9IGZyb20gJy4uL3N0YXRlL3Byb2plY3Qtc3RhdGUnO1xuXG4vLyBQcm9qZWN0SW5wdXQgQ2xhc3NcbmV4cG9ydCBjbGFzcyBQcm9qZWN0SW5wdXQgZXh0ZW5kcyBDb21wb25lbnQ8SFRNTERpdkVsZW1lbnQsIEhUTUxGb3JtRWxlbWVudD4ge1xuICAgIC8vIHRlbXBsZXRlRWxlbWVudDogSFRNTFRlbXBsYXRlRWxlbWVudDtcbiAgICAvLyBob3N0RWxlbWVudDogSFRNTERpdkVsZW1lbnQ7XG4gICAgLy8gZWxlbWVudDogSFRNTEZvcm1FbGVtZW50O1xuICAgIHRpdGxlSW5wdXRFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50O1xuICAgIGRlc2NyaXB0aW9uSW5wdXRFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50O1xuICAgIHBlb3BsZUlucHV0RWxlbWVudDogSFRNTElucHV0RWxlbWVudDtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigncHJvamVjdC1pbnB1dCcsICdhcHAnLCB0cnVlLCAndXNlci1pbnB1dCcpO1xuICAgICAgICAvLyB0aGlzLnRlbXBsZXRlRWxlbWVudCA9IDxIVE1MVGVtcGxhdGVFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9qZWN0LWlucHV0JykhO1xuICAgICAgICAvLyB0aGlzLnRlbXBsZXRlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9qZWN0LWlucHV0JykhIGFzIEhUTUxUZW1wbGF0ZUVsZW1lbnQ7XG4gICAgICAgIC8vIHRoaXMuaG9zdEVsZW1lbnQgPSAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwcCcpISBhcyBIVE1MRGl2RWxlbWVudDtcblxuICAgICAgICAvLyBjb25zdCBpbXBvcnRlZE5vZGUgPSBkb2N1bWVudC5pbXBvcnROb2RlKHRoaXMudGVtcGxldGVFbGVtZW50LmNvbnRlbnQsIHRydWUpO1xuICAgICAgICAvLyB0aGlzLmVsZW1lbnQgPSBpbXBvcnRlZE5vZGUuZmlyc3RFbGVtZW50Q2hpbGQgYXMgSFRNTEZvcm1FbGVtZW50O1xuICAgICAgICAvLyB0aGlzLmVsZW1lbnQuaWQgPSAndXNlci1pbnB1dCc7XG5cbiAgICAgICAgXG4gICAgICAgIHRoaXMudGl0bGVJbnB1dEVsZW1lbnQgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignI3RpdGxlJykgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICAgICAgdGhpcy5kZXNjcmlwdGlvbklucHV0RWxlbWVudCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcjZGVzY3JpcHRpb24nKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgICAgICB0aGlzLnBlb3BsZUlucHV0RWxlbWVudCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcjcGVvcGxlJykgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICAgICAgXG4gICAgICAgIHRoaXMuY29uZmlndXJlKCk7XG4gICAgICAgIC8vIHRoaXMuYXR0YWNoKCk7XG4gICAgfVxuXG4gICAgY29uZmlndXJlKCkge1xuICAgICAgICAvLyB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgdGhpcy5zdWJtaXRIYW5kbGVyLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgdGhpcy5zdWJtaXRIYW5kbGVyKTtcbiAgICB9XG5cbiAgICByZW5kZXJDb250ZW50KCkge1xuXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnYXRoZXJVc2VySW5wdXQoKTogW3N0cmluZywgc3RyaW5nLCBudW1iZXJdIHwgdm9pZCB7XG4gICAgICAgIGNvbnN0IGVudGVyZWRUaXRsZSA9IHRoaXMudGl0bGVJbnB1dEVsZW1lbnQudmFsdWU7XG4gICAgICAgIGNvbnN0IGVudGVyZWREZXNjcmlwdGlvbiA9IHRoaXMuZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQudmFsdWU7XG4gICAgICAgIGNvbnN0IGVudGVyZWRQZW9wbGUgPSB0aGlzLnBlb3BsZUlucHV0RWxlbWVudC52YWx1ZTtcblxuICAgICAgICBjb25zdCB0aXRsZVZhbGlkYXRhYmxlOiBWYWxpZGF0aW9uLlZhbGlkYXRhYmxlID0ge1xuICAgICAgICAgICAgdmFsdWU6IGVudGVyZWRUaXRsZSxcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGRlc2NyaXB0aW9uVmFsaWRhdGFibGU6IFZhbGlkYXRpb24uVmFsaWRhdGFibGUgPSB7XG4gICAgICAgICAgICB2YWx1ZTogZW50ZXJlZERlc2NyaXB0aW9uLFxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICBtaW5MZW5ndGg6IDVcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgcGVvcGxlVmFsaWRhdGFibGU6IFZhbGlkYXRpb24uVmFsaWRhdGFibGUgPSB7XG4gICAgICAgICAgICB2YWx1ZTogK2VudGVyZWRQZW9wbGUsXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgIG1pbjogMSxcbiAgICAgICAgICAgIG1heDogNVxuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIC8vIGVudGVyZWRUaXRsZS50cmltKCkubGVuZ3RoID09PSAwIHx8IFxuICAgICAgICAgICAgLy8gZW50ZXJlZERlc2NyaXB0aW9uLnRyaW0oKS5sZW5ndGggPT09IDAgfHwgXG4gICAgICAgICAgICAvLyBlbnRlcmVkUGVvcGxlLnRyaW0oKS5sZW5ndGggPT09IDBcblxuICAgICAgICAgICAgIVZhbGlkYXRpb24udmFsaWRhdGUodGl0bGVWYWxpZGF0YWJsZSkgfHxcbiAgICAgICAgICAgICFWYWxpZGF0aW9uLnZhbGlkYXRlKGRlc2NyaXB0aW9uVmFsaWRhdGFibGUpIHx8XG4gICAgICAgICAgICAhVmFsaWRhdGlvbi52YWxpZGF0ZShwZW9wbGVWYWxpZGF0YWJsZSkgXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBhbGVydCgnSW52YWxpZCBpbnB1dCwgcGxlYXNlIHRyeSBhZ2FpbiEnKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gW2VudGVyZWRUaXRsZSwgZW50ZXJlZERlc2NyaXB0aW9uLCArZW50ZXJlZFBlb3BsZV07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGNsZWFySW5wdXRzKCkge1xuICAgICAgICB0aGlzLnRpdGxlSW5wdXRFbGVtZW50LnZhbHVlID0gJyc7XG4gICAgICAgIHRoaXMuZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQudmFsdWUgPSAnJztcbiAgICAgICAgdGhpcy5wZW9wbGVJbnB1dEVsZW1lbnQudmFsdWUgPSAnJztcbiAgICB9XG5cbiAgICBAQXV0b2JpbmRcbiAgICBwcml2YXRlIHN1Ym1pdEhhbmRsZXIoZXZlbnQ6IEV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIC8vY29uc29sZS5sb2codGhpcy50aXRsZUlucHV0RWxlbWVudC52YWx1ZSk7XG4gICAgICAgIGNvbnN0IHVzZXJJbnB1dCA9IHRoaXMuZ2F0aGVyVXNlcklucHV0KCk7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHVzZXJJbnB1dCkpIHtcbiAgICAgICAgICAgIGNvbnN0IFt0aXRsZSwgZGVzYywgcGVvcGxlXSA9IHVzZXJJbnB1dDtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHRpdGxlLCBkZXNjLCBwZW9wbGUpO1xuICAgICAgICAgICAgcHJvamVjdFN0YXRlLmFkZFByb2plY3QodGl0bGUsIGRlc2MsIHBlb3BsZSk7XG4gICAgICAgICAgICB0aGlzLmNsZWFySW5wdXRzKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBwcml2YXRlIGF0dGFjaCgpIHtcbiAgICAvLyAgICAgdGhpcy5ob3N0RWxlbWVudC5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyYmVnaW4nLCB0aGlzLmVsZW1lbnQpO1xuICAgIC8vIH1cbn0iLCIvLyAvLy8gPHJlZmVyZW5jZSBwYXRoPVwiYmFzZS1jb21wb25lbnQudHNcIiAvPlxuLy8gLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL2RlY29yYXRvcnMvYXV0b2JpbmQudHNcIiAvPlxuLy8gLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL21vZGVscy9kcmFnLWRyb3AudHNcIiAvPlxuLy8gLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL21vZGVscy9wcm9qZWN0LnRzXCIgLz5cblxuLy8gbmFtZXNwYWNlIEFwcCB7XG4vLyAgICAgLy9Qcm9qZWN0SXRlbSBDbGFzc1xuLy8gICAgIGV4cG9ydCBjbGFzcyBQcm9qZWN0SXRlbSBleHRlbmRzIENvbXBvbmVudDxIVE1MVUxpc3RFbGVtZW50LCBIVE1MTElFbGVtZW50PiBcbi8vICAgICBpbXBsZW1lbnRzIERyYWdnYWJsZSB7XG4vLyAgICAgICAgIHByaXZhdGUgcHJvamVjdDogUHJvamVjdDtcblxuLy8gICAgICAgICBnZXQgcGVyc29ucygpIHtcbi8vICAgICAgICAgICAgIGlmICh0aGlzLnByb2plY3QucGVvcGxlID09PSAxKSB7XG4vLyAgICAgICAgICAgICAgICAgcmV0dXJuICcxIHBlcnNvbic7XG4vLyAgICAgICAgICAgICB9IGVsc2Uge1xuLy8gICAgICAgICAgICAgICAgIHJldHVybiBgJHt0aGlzLnByb2plY3QucGVvcGxlfSBwZXJzb25zYFxuLy8gICAgICAgICAgICAgfVxuLy8gICAgICAgICB9XG5cbi8vICAgICAgICAgY29uc3RydWN0b3IoaG9zdElkOiBzdHJpbmcsIHByb2plY3Q6IFByb2plY3QpIHtcbi8vICAgICAgICAgICAgIHN1cGVyKCdzaW5nbGUtcHJvamVjdCcsIGhvc3RJZCwgZmFsc2UsIHByb2plY3QuaWQpO1xuLy8gICAgICAgICAgICAgdGhpcy5wcm9qZWN0ID0gcHJvamVjdDtcblxuLy8gICAgICAgICAgICAgdGhpcy5jb25maWd1cmUoKTtcbi8vICAgICAgICAgICAgIHRoaXMucmVuZGVyQ29udGVudCgpO1xuLy8gICAgICAgICB9XG5cbi8vICAgICAgICAgQGF1dG9iaW5kXG4vLyAgICAgICAgIGRyYWdTdGFydEhhbmRsZXIoZXZlbnQ6IERyYWdFdmVudCkge1xuLy8gICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhldmVudCk7XG4vLyAgICAgICAgICAgICBldmVudC5kYXRhVHJhbnNmZXIhLnNldERhdGEoJ3RleHQvcGxhaW4nLCB0aGlzLnByb2plY3QuaWQpO1xuLy8gICAgICAgICAgICAgZXZlbnQuZGF0YVRyYW5zZmVyIS5lZmZlY3RBbGxvd2VkID0gJ21vdmUnO1xuLy8gICAgICAgICB9XG5cbi8vICAgICAgICAgZHJhZ0VuZEhhbmRsZXIoXzogRHJhZ0V2ZW50KSB7IC8vIHdlIGRvbid0IHVzZSBldmVudCBwYXJhbWV0ZXJcbi8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdEcmFnRW5kJylcbi8vICAgICAgICAgfVxuXG4vLyAgICAgICAgIGNvbmZpZ3VyZSgpIHtcbi8vICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCB0aGlzLmRyYWdTdGFydEhhbmRsZXIpO1xuLy8gICAgICAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdlbmQnLCB0aGlzLmRyYWdFbmRIYW5kbGVyKTtcbi8vICAgICAgICAgfVxuXG4vLyAgICAgICAgIHJlbmRlckNvbnRlbnQoKSB7XG4vLyAgICAgICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignaDInKSEudGV4dENvbnRlbnQgPSB0aGlzLnByb2plY3QudGl0bGU7XG4vLyAgICAgICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignaDMnKSEudGV4dENvbnRlbnQgPSB0aGlzLnBlcnNvbnMgKyAnIGFzc2lnbmVkJztcbi8vICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCdwJykhLnRleHRDb250ZW50ID0gdGhpcy5wcm9qZWN0LmRlc2NyaXB0aW9uO1xuLy8gICAgICAgICB9XG4vLyAgICAgfVxuLy8gfVxuXG5pbXBvcnQgeyBEcmFnZ2FibGUgfSBmcm9tICcuLi9tb2RlbHMvZHJhZy1kcm9wJztcbmltcG9ydCB7IFByb2plY3QgfSBmcm9tICcuLi9tb2RlbHMvcHJvamVjdCc7XG4vLyBpbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tICcuL2Jhc2UtY29tcG9uZW50LmpzJztcbmltcG9ydCBDb21wb25lbnQgZnJvbSAnLi9iYXNlLWNvbXBvbmVudCc7XG5pbXBvcnQgeyBhdXRvYmluZCB9IGZyb20gJy4uL2RlY29yYXRvcnMvYXV0b2JpbmQnO1xuXG4vL1Byb2plY3RJdGVtIENsYXNzXG5leHBvcnQgY2xhc3MgUHJvamVjdEl0ZW0gZXh0ZW5kcyBDb21wb25lbnQ8SFRNTFVMaXN0RWxlbWVudCwgSFRNTExJRWxlbWVudD4gXG5pbXBsZW1lbnRzIERyYWdnYWJsZSB7XG4gICAgcHJpdmF0ZSBwcm9qZWN0OiBQcm9qZWN0O1xuXG4gICAgZ2V0IHBlcnNvbnMoKSB7XG4gICAgICAgIGlmICh0aGlzLnByb2plY3QucGVvcGxlID09PSAxKSB7XG4gICAgICAgICAgICByZXR1cm4gJzEgcGVyc29uJztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBgJHt0aGlzLnByb2plY3QucGVvcGxlfSBwZXJzb25zYFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IoaG9zdElkOiBzdHJpbmcsIHByb2plY3Q6IFByb2plY3QpIHtcbiAgICAgICAgc3VwZXIoJ3NpbmdsZS1wcm9qZWN0JywgaG9zdElkLCBmYWxzZSwgcHJvamVjdC5pZCk7XG4gICAgICAgIHRoaXMucHJvamVjdCA9IHByb2plY3Q7XG5cbiAgICAgICAgdGhpcy5jb25maWd1cmUoKTtcbiAgICAgICAgdGhpcy5yZW5kZXJDb250ZW50KCk7XG4gICAgfVxuXG4gICAgQGF1dG9iaW5kXG4gICAgZHJhZ1N0YXJ0SGFuZGxlcihldmVudDogRHJhZ0V2ZW50KSB7XG4gICAgICAgIC8vY29uc29sZS5sb2coZXZlbnQpO1xuICAgICAgICBldmVudC5kYXRhVHJhbnNmZXIhLnNldERhdGEoJ3RleHQvcGxhaW4nLCB0aGlzLnByb2plY3QuaWQpO1xuICAgICAgICBldmVudC5kYXRhVHJhbnNmZXIhLmVmZmVjdEFsbG93ZWQgPSAnbW92ZSc7XG4gICAgfVxuXG4gICAgZHJhZ0VuZEhhbmRsZXIoXzogRHJhZ0V2ZW50KSB7IC8vIHdlIGRvbid0IHVzZSBldmVudCBwYXJhbWV0ZXJcbiAgICAgICAgY29uc29sZS5sb2coJ0RyYWdFbmQnKVxuICAgIH1cblxuICAgIGNvbmZpZ3VyZSgpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIHRoaXMuZHJhZ1N0YXJ0SGFuZGxlcik7XG4gICAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnZW5kJywgdGhpcy5kcmFnRW5kSGFuZGxlcik7XG4gICAgfVxuXG4gICAgcmVuZGVyQ29udGVudCgpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2gyJykhLnRleHRDb250ZW50ID0gdGhpcy5wcm9qZWN0LnRpdGxlO1xuICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignaDMnKSEudGV4dENvbnRlbnQgPSB0aGlzLnBlcnNvbnMgKyAnIGFzc2lnbmVkJztcbiAgICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3AnKSEudGV4dENvbnRlbnQgPSB0aGlzLnByb2plY3QuZGVzY3JpcHRpb247XG4gICAgfVxufSIsIi8vIC8vLyA8cmVmZXJlbmNlIHBhdGg9XCJiYXNlLWNvbXBvbmVudC50c1wiIC8+XG4vLyAvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vZGVjb3JhdG9ycy9hdXRvYmluZC50c1wiIC8+XG4vLyAvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vbW9kZWxzL2RyYWctZHJvcC50c1wiIC8+XG4vLyAvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vbW9kZWxzL3Byb2plY3QudHNcIiAvPlxuLy8gLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL3N0YXRlL3Byb2plY3Qtc3RhdGUudHNcIiAvPlxuXG4vLyBuYW1lc3BhY2UgQXBwIHtcbi8vICAgICAvLyBQcm9qZWN0TGlzdCAgQ2xhc3MgXG4vLyAgICAgZXhwb3J0IGNsYXNzIFByb2plY3RMaXN0IGV4dGVuZHMgQ29tcG9uZW50PEhUTUxEaXZFbGVtZW50LCBIVE1MRWxlbWVudD5cbi8vICAgICBpbXBsZW1lbnRzIERyYWdUYXJnZXQge1xuLy8gICAgICAgICAvLyB0ZW1wbGV0ZUVsZW1lbnQ6IEhUTUxUZW1wbGF0ZUVsZW1lbnQ7XG4vLyAgICAgICAgIC8vIGhvc3RFbGVtZW50OiBIVE1MRGl2RWxlbWVudDtcbi8vICAgICAgICAgLy8gZWxlbWVudDogSFRNTEVsZW1lbnQ7IC8vIDxzZWN0aW9uPlxuLy8gICAgICAgICBhc2lnbmVkUHJvamVjdHM6IFByb2plY3RbXTtcblxuLy8gICAgICAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHR5cGU6ICdhY3RpdmUnIHwgJ2ZpbmlzaGVkJykge1xuLy8gICAgICAgICAgICAgc3VwZXIoJ3Byb2plY3QtbGlzdCcsICdhcHAnLCBmYWxzZSwgYCR7dHlwZX0tcHJvamVjdHNgKTtcbi8vICAgICAgICAgICAgIC8vIHRoaXMudGVtcGxldGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2plY3QtbGlzdCcpISBhcyBIVE1MVGVtcGxhdGVFbGVtZW50O1xuLy8gICAgICAgICAgICAgLy8gdGhpcy5ob3N0RWxlbWVudCA9ICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXBwJykhIGFzIEhUTUxEaXZFbGVtZW50O1xuLy8gICAgICAgICAgICAgdGhpcy5hc2lnbmVkUHJvamVjdHMgPSBbXTtcblxuLy8gICAgICAgICAgICAgLy8gY29uc3QgaW1wb3J0ZWROb2RlID0gZG9jdW1lbnQuaW1wb3J0Tm9kZSh0aGlzLnRlbXBsZXRlRWxlbWVudC5jb250ZW50LCB0cnVlKTtcbi8vICAgICAgICAgICAgIC8vIHRoaXMuZWxlbWVudCA9IGltcG9ydGVkTm9kZS5maXJzdEVsZW1lbnRDaGlsZCBhcyBIVE1MRWxlbWVudDtcbi8vICAgICAgICAgICAgIC8vIHRoaXMuZWxlbWVudC5pZCA9IGAke3R5cGV9LXByb2plY3RzYDtcblxuLy8gICAgICAgICAgICAgdGhpcy5jb25maWd1cmUoKTtcblxuLy8gICAgICAgICAgICAgLy8gdGhpcy5hdHRhY2goKTtcbi8vICAgICAgICAgICAgIHRoaXMucmVuZGVyQ29udGVudCgpO1xuLy8gICAgICAgICB9XG5cbi8vICAgICAgICAgQGF1dG9iaW5kXG4vLyAgICAgICAgIGRyYWdPdmVySGFuZGxlcihldmVudDogRHJhZ0V2ZW50KSB7XG4vLyAgICAgICAgICAgICBpZiAoZXZlbnQuZGF0YVRyYW5zZmVyICYmIGV2ZW50LmRhdGFUcmFuc2Zlci50eXBlc1swXSA9PT0gJ3RleHQvcGxhaW4nKSB7XG4vLyAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbi8vICAgICAgICAgICAgICAgICBjb25zdCBsaXN0RWwgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcigndWwnKSE7XG4vLyAgICAgICAgICAgICAgICAgbGlzdEVsLmNsYXNzTGlzdC5hZGQoJ2Ryb3BwYWJsZScpO1xuLy8gICAgICAgICAgICAgfSAgICBcbi8vICAgICAgICAgfVxuXG4vLyAgICAgICAgIEBhdXRvYmluZFxuLy8gICAgICAgICBkcm9wSGFuZGxlcihldmVudDogRHJhZ0V2ZW50KSB7XG4vLyAgICAgICAgICAgICBjb25zdCBwcmpJZCA9IGV2ZW50LmRhdGFUcmFuc2ZlciEuZ2V0RGF0YSgndGV4dC9wbGFpbicpO1xuLy8gICAgICAgICAgICAgcHJvamVjdFN0YXRlLm1vdmVQcm9qZWN0KHByaklkLCBcbi8vICAgICAgICAgICAgICAgICB0aGlzLnR5cGUgPT09ICdhY3RpdmUnID8gUHJvamVjdFN0YXR1cy5BY3RpdmUgOiBQcm9qZWN0U3RhdHVzLkZpbmlzaGVkKTtcbi8vICAgICAgICAgfVxuXG4vLyAgICAgICAgIEBhdXRvYmluZFxuLy8gICAgICAgICBkcmFnTGVhdmVIYW5kbGVyKF86IERyYWdFdmVudCkge1xuLy8gICAgICAgICAgICAgY29uc3QgbGlzdEVsID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3VsJykhO1xuLy8gICAgICAgICAgICAgbGlzdEVsLmNsYXNzTGlzdC5yZW1vdmUoJ2Ryb3BwYWJsZScpO1xuLy8gICAgICAgICB9XG5cbi8vICAgICAgICAgY29uZmlndXJlKCkge1xuLy8gICAgICAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgdGhpcy5kcmFnT3ZlckhhbmRsZXIpO1xuLy8gICAgICAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdsZWF2ZScsIHRoaXMuZHJhZ0xlYXZlSGFuZGxlcik7XG4vLyAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIHRoaXMuZHJvcEhhbmRsZXIpO1xuXG4vLyAgICAgICAgICAgICBwcm9qZWN0U3RhdGUuYWRkTGlzdGVuZXIoKHByb2plY3RzOiBQcm9qZWN0W10pID0+IHtcbi8vICAgICAgICAgICAgICAgICBjb25zdCByZWxldmFudFByb2plY3RzID0gcHJvamVjdHMuZmlsdGVyKHByaiA9PiB7XG4vLyAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnR5cGUgPT09ICdhY3RpdmUnKSB7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJqLnN0YXR1cyA9PT0gUHJvamVjdFN0YXR1cy5BY3RpdmU7XG4vLyAgICAgICAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByai5zdGF0dXMgPT09IFByb2plY3RTdGF0dXMuRmluaXNoZWQ7XG4vLyAgICAgICAgICAgICAgICAgfSk7XG4vLyAgICAgICAgICAgICAgICAgdGhpcy5hc2lnbmVkUHJvamVjdHMgPSByZWxldmFudFByb2plY3RzO1xuLy8gICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyUHJvamVjdHMoKTtcbi8vICAgICAgICAgICAgIH0pO1xuLy8gICAgICAgICB9XG5cbi8vICAgICAgICAgcmVuZGVyQ29udGVudCgpIHtcbi8vICAgICAgICAgICAgIGNvbnN0IGxpc3RJZCA9IGAke3RoaXMudHlwZX0tcHJvamVjdHMtbGlzdGA7XG4vLyAgICAgICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcigndWwnKSEuaWQgPSBsaXN0SWQ7XG4vLyAgICAgICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignaDInKSEudGV4dENvbnRlbnQgPSB0aGlzLnR5cGUudG9VcHBlckNhc2UoKSArICcgUFJPSkVDVFMnO1xuLy8gICAgICAgICB9XG5cbi8vICAgICAgICAgcHJpdmF0ZSByZW5kZXJQcm9qZWN0cygpIHtcbi8vICAgICAgICAgICAgIGNvbnN0IGxpc3RFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke3RoaXMudHlwZX0tcHJvamVjdHMtbGlzdGApISBhcyBIVE1MVUxpc3RFbGVtZW50O1xuLy8gICAgICAgICAgICAgbGlzdEVsLmlubmVySFRNTCA9ICcnO1xuLy8gICAgICAgICAgICAgZm9yIChjb25zdCBwcmpJdGVtIG9mIHRoaXMuYXNpZ25lZFByb2plY3RzKSB7XG4vLyAgICAgICAgICAgICAgICAgLy8gY29uc3QgbGlzdEl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuLy8gICAgICAgICAgICAgICAgIC8vIGxpc3RJdGVtLnRleHRDb250ZW50ID0gcHJqSXRlbS50aXRsZTtcbi8vICAgICAgICAgICAgICAgICAvLyBsaXN0RWwuYXBwZW5kQ2hpbGQobGlzdEl0ZW0pO1xuLy8gICAgICAgICAgICAgICAgIG5ldyBQcm9qZWN0SXRlbSh0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcigndWwnKSEuaWQsIHByakl0ZW0pO1xuLy8gICAgICAgICAgICAgfVxuLy8gICAgICAgICB9XG5cbi8vICAgICAgICAgLy8gcHJpdmF0ZSBhdHRhY2goKSB7XG4vLyAgICAgICAgIC8vICAgICB0aGlzLmhvc3RFbGVtZW50Lmluc2VydEFkamFjZW50RWxlbWVudCgnYmVmb3JlZW5kJywgdGhpcy5lbGVtZW50KTtcbi8vICAgICAgICAgLy8gfVxuLy8gICAgIH1cbi8vIH1cblxuaW1wb3J0IHsgRHJhZ1RhcmdldCB9IGZyb20gJy4uL21vZGVscy9kcmFnLWRyb3AnO1xuaW1wb3J0IHsgUHJvamVjdCwgUHJvamVjdFN0YXR1cyB9IGZyb20gJy4uL21vZGVscy9wcm9qZWN0Jztcbi8vIGltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gJy4vYmFzZS1jb21wb25lbnQuanMnO1xuaW1wb3J0IENvbXBvbmVudCBmcm9tICcuL2Jhc2UtY29tcG9uZW50JztcbmltcG9ydCB7IGF1dG9iaW5kIH0gZnJvbSAnLi4vZGVjb3JhdG9ycy9hdXRvYmluZCc7XG5pbXBvcnQgeyBwcm9qZWN0U3RhdGUgfSBmcm9tICcuLi9zdGF0ZS9wcm9qZWN0LXN0YXRlJztcbmltcG9ydCB7IFByb2plY3RJdGVtIH0gZnJvbSAnLi9wcm9qZWN0LWl0ZW0nO1xuXG4vLyBQcm9qZWN0TGlzdCAgQ2xhc3MgXG5leHBvcnQgY2xhc3MgUHJvamVjdExpc3QgZXh0ZW5kcyBDb21wb25lbnQ8SFRNTERpdkVsZW1lbnQsIEhUTUxFbGVtZW50PlxuaW1wbGVtZW50cyBEcmFnVGFyZ2V0IHtcbiAgICAvLyB0ZW1wbGV0ZUVsZW1lbnQ6IEhUTUxUZW1wbGF0ZUVsZW1lbnQ7XG4gICAgLy8gaG9zdEVsZW1lbnQ6IEhUTUxEaXZFbGVtZW50O1xuICAgIC8vIGVsZW1lbnQ6IEhUTUxFbGVtZW50OyAvLyA8c2VjdGlvbj5cbiAgICBhc2lnbmVkUHJvamVjdHM6IFByb2plY3RbXTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgdHlwZTogJ2FjdGl2ZScgfCAnZmluaXNoZWQnKSB7XG4gICAgICAgIHN1cGVyKCdwcm9qZWN0LWxpc3QnLCAnYXBwJywgZmFsc2UsIGAke3R5cGV9LXByb2plY3RzYCk7XG4gICAgICAgIC8vIHRoaXMudGVtcGxldGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2plY3QtbGlzdCcpISBhcyBIVE1MVGVtcGxhdGVFbGVtZW50O1xuICAgICAgICAvLyB0aGlzLmhvc3RFbGVtZW50ID0gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcHAnKSEgYXMgSFRNTERpdkVsZW1lbnQ7XG4gICAgICAgIHRoaXMuYXNpZ25lZFByb2plY3RzID0gW107XG5cbiAgICAgICAgLy8gY29uc3QgaW1wb3J0ZWROb2RlID0gZG9jdW1lbnQuaW1wb3J0Tm9kZSh0aGlzLnRlbXBsZXRlRWxlbWVudC5jb250ZW50LCB0cnVlKTtcbiAgICAgICAgLy8gdGhpcy5lbGVtZW50ID0gaW1wb3J0ZWROb2RlLmZpcnN0RWxlbWVudENoaWxkIGFzIEhUTUxFbGVtZW50O1xuICAgICAgICAvLyB0aGlzLmVsZW1lbnQuaWQgPSBgJHt0eXBlfS1wcm9qZWN0c2A7XG5cbiAgICAgICAgdGhpcy5jb25maWd1cmUoKTtcblxuICAgICAgICAvLyB0aGlzLmF0dGFjaCgpO1xuICAgICAgICB0aGlzLnJlbmRlckNvbnRlbnQoKTtcbiAgICB9XG5cbiAgICBAYXV0b2JpbmRcbiAgICBkcmFnT3ZlckhhbmRsZXIoZXZlbnQ6IERyYWdFdmVudCkge1xuICAgICAgICBpZiAoZXZlbnQuZGF0YVRyYW5zZmVyICYmIGV2ZW50LmRhdGFUcmFuc2Zlci50eXBlc1swXSA9PT0gJ3RleHQvcGxhaW4nKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgY29uc3QgbGlzdEVsID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3VsJykhO1xuICAgICAgICAgICAgbGlzdEVsLmNsYXNzTGlzdC5hZGQoJ2Ryb3BwYWJsZScpO1xuICAgICAgICB9ICAgIFxuICAgIH1cblxuICAgIEBhdXRvYmluZFxuICAgIGRyb3BIYW5kbGVyKGV2ZW50OiBEcmFnRXZlbnQpIHtcbiAgICAgICAgY29uc3QgcHJqSWQgPSBldmVudC5kYXRhVHJhbnNmZXIhLmdldERhdGEoJ3RleHQvcGxhaW4nKTtcbiAgICAgICAgcHJvamVjdFN0YXRlLm1vdmVQcm9qZWN0KHByaklkLCBcbiAgICAgICAgICAgIHRoaXMudHlwZSA9PT0gJ2FjdGl2ZScgPyBQcm9qZWN0U3RhdHVzLkFjdGl2ZSA6IFByb2plY3RTdGF0dXMuRmluaXNoZWQpO1xuICAgIH1cblxuICAgIEBhdXRvYmluZFxuICAgIGRyYWdMZWF2ZUhhbmRsZXIoXzogRHJhZ0V2ZW50KSB7XG4gICAgICAgIGNvbnN0IGxpc3RFbCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCd1bCcpITtcbiAgICAgICAgbGlzdEVsLmNsYXNzTGlzdC5yZW1vdmUoJ2Ryb3BwYWJsZScpO1xuICAgIH1cblxuICAgIGNvbmZpZ3VyZSgpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgdGhpcy5kcmFnT3ZlckhhbmRsZXIpO1xuICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ2xlYXZlJywgdGhpcy5kcmFnTGVhdmVIYW5kbGVyKTtcbiAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCB0aGlzLmRyb3BIYW5kbGVyKTtcblxuICAgICAgICBwcm9qZWN0U3RhdGUuYWRkTGlzdGVuZXIoKHByb2plY3RzOiBQcm9qZWN0W10pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlbGV2YW50UHJvamVjdHMgPSBwcm9qZWN0cy5maWx0ZXIocHJqID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy50eXBlID09PSAnYWN0aXZlJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJqLnN0YXR1cyA9PT0gUHJvamVjdFN0YXR1cy5BY3RpdmU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBwcmouc3RhdHVzID09PSBQcm9qZWN0U3RhdHVzLkZpbmlzaGVkO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLmFzaWduZWRQcm9qZWN0cyA9IHJlbGV2YW50UHJvamVjdHM7XG4gICAgICAgICAgICB0aGlzLnJlbmRlclByb2plY3RzKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHJlbmRlckNvbnRlbnQoKSB7XG4gICAgICAgIGNvbnN0IGxpc3RJZCA9IGAke3RoaXMudHlwZX0tcHJvamVjdHMtbGlzdGA7XG4gICAgICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCd1bCcpIS5pZCA9IGxpc3RJZDtcbiAgICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2gyJykhLnRleHRDb250ZW50ID0gdGhpcy50eXBlLnRvVXBwZXJDYXNlKCkgKyAnIFBST0pFQ1RTJztcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlbmRlclByb2plY3RzKCkge1xuICAgICAgICBjb25zdCBsaXN0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHt0aGlzLnR5cGV9LXByb2plY3RzLWxpc3RgKSEgYXMgSFRNTFVMaXN0RWxlbWVudDtcbiAgICAgICAgbGlzdEVsLmlubmVySFRNTCA9ICcnO1xuICAgICAgICBmb3IgKGNvbnN0IHByakl0ZW0gb2YgdGhpcy5hc2lnbmVkUHJvamVjdHMpIHtcbiAgICAgICAgICAgIC8vIGNvbnN0IGxpc3RJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgICAgICAgICAgIC8vIGxpc3RJdGVtLnRleHRDb250ZW50ID0gcHJqSXRlbS50aXRsZTtcbiAgICAgICAgICAgIC8vIGxpc3RFbC5hcHBlbmRDaGlsZChsaXN0SXRlbSk7XG4gICAgICAgICAgICBuZXcgUHJvamVjdEl0ZW0odGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3VsJykhLmlkLCBwcmpJdGVtKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIHByaXZhdGUgYXR0YWNoKCkge1xuICAgIC8vICAgICB0aGlzLmhvc3RFbGVtZW50Lmluc2VydEFkamFjZW50RWxlbWVudCgnYmVmb3JlZW5kJywgdGhpcy5lbGVtZW50KTtcbiAgICAvLyB9XG59IiwiLy8gLy8vIDxyZWZlcmVuY2UgcGF0aD1cImNvbXBvbmVudHMvcHJvamVjdC1pbnB1dC50c1wiIC8+XG4vLyAvLy8gPHJlZmVyZW5jZSBwYXRoPVwiY29tcG9uZW50cy9wcm9qZWN0LWxpc3QudHNcIiAvPlxuXG4vLyBuYW1lc3BhY2UgQXBwIHsgXG4vLyAgICAgY29uc3QgcHJqSW5wdXQgPSBuZXcgUHJvamVjdElucHV0KCk7XG4vLyAgICAgY29uc3QgYWN0aXZlUHJqTGlzdCA9IG5ldyBQcm9qZWN0TGlzdCgnYWN0aXZlJyk7XG4vLyAgICAgY29uc3QgZmluaXNoZWRQcmpMaXN0ID0gbmV3IFByb2plY3RMaXN0KCdmaW5pc2hlZCcpO1xuLy8gfVxuXG5cbmltcG9ydCB7IFByb2plY3RJbnB1dCB9IGZyb20gJy4vY29tcG9uZW50cy9wcm9qZWN0LWlucHV0JztcbmltcG9ydCB7IFByb2plY3RMaXN0IH0gZnJvbSAnLi9jb21wb25lbnRzL3Byb2plY3QtbGlzdCc7XG5cbmNvbnN0IHByaklucHV0ID0gbmV3IFByb2plY3RJbnB1dCgpO1xuY29uc3QgYWN0aXZlUHJqTGlzdCA9IG5ldyBQcm9qZWN0TGlzdCgnYWN0aXZlJyk7XG5jb25zdCBmaW5pc2hlZFByakxpc3QgPSBuZXcgUHJvamVjdExpc3QoJ2ZpbmlzaGVkJyk7XG4iXSwibmFtZXMiOlsiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJ0ZW1wbGF0ZUlkIiwiaG9zdEVsZW1lbnRJZCIsImluc2VydEF0U3RhcnQiLCJuZXdFbGVtZW50SWQiLCJ0aGlzIiwidGVtcGxldGVFbGVtZW50IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImhvc3RFbGVtZW50IiwiaW1wb3J0ZWROb2RlIiwiaW1wb3J0Tm9kZSIsImNvbnRlbnQiLCJlbGVtZW50IiwiZmlyc3RFbGVtZW50Q2hpbGQiLCJpZCIsImF0dGFjaCIsImluc2VydEF0QmVnZ2luaW5nIiwiaW5zZXJ0QWRqYWNlbnRFbGVtZW50IiwidmFsaWRhdGUiLCJ2YWxpZGF0YWJsZUlucHV0IiwiaXNWYWxpZCIsInJlcXVpcmVkIiwidmFsdWUiLCJ0b1N0cmluZyIsInRyaW0iLCJsZW5ndGgiLCJtaW5MZW5ndGgiLCJtYXhMZW5ndGgiLCJtaW4iLCJtYXgiLCJhdXRvYmluZCIsIl8iLCJfMiIsImRlc2NyaXB0b3IiLCJvcmlnaW5hbE1ldGhvZCIsImNvbmZpZ3VyYWJsZSIsImdldCIsImJpbmQiLCJQcm9qZWN0U3RhdHVzIiwiUHJvamVjdCIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJwZW9wbGUiLCJzdGF0dXMiLCJQcm9qZWN0U3RhdGUiLCJsaXN0ZW5lcnMiLCJhZGRMaXN0ZW5lciIsImxpc3RlbmVyRm4iLCJwdXNoIiwic3VwZXIiLCJwcm9qZWN0cyIsInN0YXRpYyIsImluc3RhbmNlIiwiYWRkUHJvamVjdCIsIm51bU9mUGVvcGxlIiwibmV3UHJvamVjdCIsIk1hdGgiLCJyYW5kb20iLCJBY3RpdmUiLCJ1cGRhdGVMaXN0ZW5lcnMiLCJtb3ZlUHJvamVjdCIsInByb2plY3RJZCIsIm5ld1N0YXR1cyIsInByb2plY3QiLCJmaW5kIiwicHJqIiwic2xpY2UiLCJjb25zb2xlIiwibG9nIiwicHJvamVjdFN0YXRlIiwiZ2V0SW5zdGFuY2UiLCJQcm9qZWN0SW5wdXQiLCJ0aXRsZUlucHV0RWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJkZXNjcmlwdGlvbklucHV0RWxlbWVudCIsInBlb3BsZUlucHV0RWxlbWVudCIsImNvbmZpZ3VyZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJzdWJtaXRIYW5kbGVyIiwicmVuZGVyQ29udGVudCIsImdhdGhlclVzZXJJbnB1dCIsImVudGVyZWRUaXRsZSIsImVudGVyZWREZXNjcmlwdGlvbiIsImVudGVyZWRQZW9wbGUiLCJkZXNjcmlwdGlvblZhbGlkYXRhYmxlIiwicGVvcGxlVmFsaWRhdGFibGUiLCJhbGVydCIsImNsZWFySW5wdXRzIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsInVzZXJJbnB1dCIsIkFycmF5IiwiaXNBcnJheSIsImRlc2MiLCJQcm9qZWN0SXRlbSIsImhvc3RJZCIsInBlcnNvbnMiLCJkcmFnU3RhcnRIYW5kbGVyIiwiZGF0YVRyYW5zZmVyIiwic2V0RGF0YSIsImVmZmVjdEFsbG93ZWQiLCJkcmFnRW5kSGFuZGxlciIsInRleHRDb250ZW50IiwiUHJvamVjdExpc3QiLCJ0eXBlIiwiYXNpZ25lZFByb2plY3RzIiwiZHJhZ092ZXJIYW5kbGVyIiwidHlwZXMiLCJjbGFzc0xpc3QiLCJhZGQiLCJkcm9wSGFuZGxlciIsInByaklkIiwiZ2V0RGF0YSIsIkZpbmlzaGVkIiwiZHJhZ0xlYXZlSGFuZGxlciIsInJlbW92ZSIsInJlbGV2YW50UHJvamVjdHMiLCJmaWx0ZXIiLCJyZW5kZXJQcm9qZWN0cyIsImxpc3RJZCIsInRvVXBwZXJDYXNlIiwiaW5uZXJIVE1MIiwicHJqSXRlbSJdLCJzb3VyY2VSb290IjoiIn0=